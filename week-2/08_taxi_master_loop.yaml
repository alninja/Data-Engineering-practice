id: 08_taxi_master_loop
namespace: zoomcamp
description: |
  Loop to backfill 2021 data for Yellow and Green taxis. Iterates through 2 taxi types and months 01-07.

tasks:
  - id: for_each_taxi
    type: io.kestra.plugin.core.flow.ForEach
    values: ["yellow", "green"]
    
    tasks:
      - id: for_each_month
        type: io.kestra.plugin.core.flow.ForEach
        values: ["01", "02", "03", "04", "05", "06", "07"]
        
        tasks:
          - id: trigger_subflow
            type: io.kestra.plugin.core.flow.Subflow
            flowId: 08_gcp_taxi
            namespace: zoomcamp
            wait: true # Set to true to process sequentially and avoid BQ concurrency limits
            transmitFailed: true
            inputs:
              taxi: "{{ parent.taskrun.value }}"
              year: "2021"
              month: "{{ taskrun.value }}"